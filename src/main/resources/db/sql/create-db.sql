DROP TABLE Estado IF EXISTS CASCADE;
DROP TABLE Tarea IF EXISTS CASCADE;
DROP TABLE Usuario IF EXISTS CASCADE;
DROP TABLE Roles IF EXISTS CASCADE;
DROP TABLE TipoTarea IF EXISTS CASCADE;
DROP TABLE Acceso IF EXISTS CASCADE;


CREATE TABLE Roles (
  RolId INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
  Descripcion 	VARCHAR(30),
);


CREATE TABLE TipoTarea (
  TipoTareaId INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
  Descripcion 	VARCHAR(30),
);

CREATE TABLE Estado (
  EstadoId INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
  Descripcion 	VARCHAR(30),
);



CREATE TABLE Usuario (
  UsuarioId INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY NOT NULL,
  Nombre 	VARCHAR(30),
  Apellido 	VARCHAR(30),
  Email  	VARCHAR(50),
  Password	VARCHAR(50),
  RolId		INTEGER,
  Activo	BOOLEAN,
  FechaAlta	DATE,
  Aprobado BOOLEAN default false
);
ALTER TABLE Usuario ADD CONSTRAINT id_rol FOREIGN KEY (RolId) REFERENCES Roles(RolId);


CREATE TABLE Tarea (
  TareaId INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1, INCREMENT BY 1) PRIMARY KEY,
  Titulo	VARCHAR(30),
  Descripcion 	VARCHAR(200),  
  EstadoId	INTEGER,  
  TipoTarea	INTEGER,  
  UsuarioAlta	INTEGER,
  UsuarioAsignado INTEGER, 
  FechaAlta	DATE
);


ALTER TABLE Tarea ADD CONSTRAINT id_usuario_tarea FOREIGN KEY (UsuarioAlta) REFERENCES Usuario(UsuarioId);
ALTER TABLE Tarea ADD CONSTRAINT id_usuario_asignado FOREIGN KEY (UsuarioAsignado) REFERENCES Usuario(UsuarioId);
ALTER TABLE Tarea ADD CONSTRAINT id_estado_tarea FOREIGN KEY (EstadoId) REFERENCES Estado(EstadoId);
ALTER TABLE Tarea ADD CONSTRAINT id_tipo_tarea FOREIGN KEY (TipoTarea) REFERENCES TipoTarea(TipoTareaId);



CREATE TABLE Acceso (
  UsuarioId INTEGER,  
  TareaId INTEGER,
  Editable BOOLEAN
);

ALTER TABLE Acceso ADD CONSTRAINT pk_acceso PRIMARY KEY (UsuarioId,TareaId);
ALTER TABLE Acceso ADD CONSTRAINT id_usuario_acceso FOREIGN KEY (UsuarioId) REFERENCES Usuario(UsuarioId);
ALTER TABLE Acceso ADD CONSTRAINT id_tarea_acceso FOREIGN KEY (TareaId) REFERENCES Tarea(TareaId);
